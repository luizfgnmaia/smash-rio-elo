library(dplyr)
load("data/sets_fixed.RData")
for(i in 1:nrow(sets_fixed)) {
if(sets_fixed$p1[i] > sets_fixed$p2[i]) {
tmp_p1 = sets_fixed$p1[i]
tmp_id1 = sets_fixed$id1[i]
tmp_score1 = sets_fixed$score1[i]
sets_fixed$p1[i] = sets_fixed$p2[i]
sets_fixed$id1[i] = sets_fixed$id2[i]
sets_fixed$score1[i] = sets_fixed$score2[i]
sets_fixed$p2[i] = tmp_p1
sets_fixed$id2[i] = tmp_id1
sets_fixed$score2[i] = tmp_score1
}
}
sets_suma = sets_fixed %>%
mutate(win_p1 = ifelse(score1 > score2, 1, 0)) %>%
mutate(win_p2 = ifelse(score1 > score2, 0, 1)) %>%
group_by(p1, p2) %>%
summarise(sets = n(),
set_wins_p1 = sum(win_p1),
set_wins_p2 = sum(win_p2),
game_wins_p1 = sum(score1),
game_wins_p2 = sum(score2),
tournaments = paste(tournament, collapse = ", ")) %>%
arrange(desc(sets))
sets_suma
save(sets_suma, file = "data/sets_suma.RData")
write.table(sets_suma, file = "data/sets_suma.csv", sep = ",", na = "", row.names = FALSE)
View(sets_suma)
library(dplyr)
source("json_to_df.R")
sets_raw = list.files("data/tournaments") %>%
lapply(json_to_df) %>%
do.call(rbind, .) %>%
filter(score1 >= 0, score2 >= 0) %>%
rowwise() %>%
mutate(first_to = max(score1, score2))
sets_raw
save(sets_raw, file = "data/sets_raw.RData")
write.table(sets_raw, file = "data/sets_raw.csv", sep = ",", na = "", row.names = FALSE)
sets_fixed = sets_raw
fix <- function(df, old_name, new_name, tournament = NULL) {
if(!is.null(tournament)) {
df$p1[which(df$p1 == old_name & df$tournament == tournament)] = new_name
df$p2[which(df$p2 == old_name & df$tournament == tournament)] = new_name
} else {
df$p1[which(df$p1 == old_name)] = new_name
df$p2[which(df$p2 == old_name)] = new_name
}
df
}
sets_fixed = sets_fixed %>%
fix("ace", "Ace") %>%
fix("Amortaxx", "Amortax") %>%
fix("Burtao", "Burtão") %>%
#Artch?
fix("Dr. NEFÁRIO", "Chino") %>%
fix("Festa", "Fexta!") %>%
fix("Thi Festa", "Fexta!") %>%
fix("gamer girl", "Sky") %>%
fix("jao", "Jao") %>% # ?
#Janjão?
fix("Lugia", "LUGIA") %>%
fix("Monado", "Monad0") %>%
fix("Morkerz", "Morkez") %>% # ?
fix("Sahione Advogados", "Joaoarara") %>%
fix("Sem chance", "S/Chance") %>%
fix("ROT | Conker", "Conker") %>%
fix("ROT|Sully", "Sully") %>%
fix("FyFox", "Fy") %>%
fix("Oliveira", "Naval") %>%
fix("Conker", "Chadin", "Battle Of Hyrule")
sets_fixed
save(sets_fixed, file = "data/sets_fixed.RData")
write.table(sets_fixed, file = "data/sets_fixed.csv", sep = ",", na = "", row.names = FALSE)
last = unique(sets_fixed$tournament)[length(unique(sets_fixed$tournament))] # último campeonato
tmp = sets_fixed %>%
filter(tournament != last)
players = unique(c(tmp$p1, tmp$p2))
tmp2 = sets_fixed %>%
filter(tournament == last)
players_last = unique(c(tmp2$p1, tmp2$p2))
setdiff(players_last, players)
library(dplyr)
library(elo)
load("data/sets_fixed.RData")
sets = sets_fixed
sets = sets %>%
mutate(result = score1/(score1 + score2),
k = first_to * 10)
sets
players = tibble(player = c(sets$p1, sets$p2))
players = data.frame(player = unique(c(sets$p1, sets$p2))) %>%
mutate(elo = 1500)
players
for (i in 1:nrow(sets)) {
set = sets[i,]
p1_elo = subset(players, player == set$p1)$elo
p2_elo = subset(players, player == set$p2)$elo
new_elo = elo.calc(wins.A = set$result,
elo.A = p1_elo,
elo.B = p2_elo,
k = set$k)
p1_new_elo = new_elo[1, 1]
p2_new_elo = new_elo[1, 2]
players = players %>%
mutate(elo = if_else(player == set$p1, p1_new_elo,
if_else(player == set$p2, p2_new_elo, elo)))
}
players %>%
arrange(desc(elo))
players = players %>%
mutate(set_wins = NA,
total_sets = NA,
set_perc = NA,
game_wins = NA,
total_games = NA,
game_perc = NA,
tournaments = NA,
list_tournaments = NA)
for(i in 1:nrow(players)){
p1 = sets %>%
filter(p1 == players$player[i])
set_wins_1 = p1 %>%
filter(result > 0.5) %>%
nrow()
total_sets_1 = p1 %>%
nrow()
game_wins_1 = sum(p1$score1)
total_games_1 = sum(p1$score1) + sum(p1$score2)
p2 = sets %>%
filter(p2 == players$player[i])
set_wins_2 = p2 %>%
filter(result < 0.5) %>%
nrow()
total_sets_2 = p2 %>%
nrow()
game_wins_2 = sum(p2$score2)
total_games_2 = sum(p2$score1) + sum(p2$score2)
players$set_wins[i] = set_wins_1 + set_wins_2
players$total_sets[i] = total_sets_1 + total_sets_2
players$set_perc[i] = players$set_wins[i]/players$total_sets[i]
players$game_wins[i] = game_wins_1 + game_wins_2
players$total_games[i] = total_games_1 + total_games_2
players$game_perc[i] = players$game_wins[i]/players$total_games[i]
players$tournaments[i] = length(unique(c(p1$tournament, p2$tournament)))
players$list_tournaments[i] = paste(unique(c(p1$tournament, p2$tournament)), collapse = ", ")
}
players = players %>%
arrange(desc(elo))
players
save(players, file = "data/players.RData")
write.table(players, file = "data/players.csv", sep = ",", na = "", row.names = FALSE, dec = ",")
View(players)
